#!/usr/bin/env ruby
# frozen_string_literal: true

gemfile = ENV["BUNDLE_GEMFILE"] || "Gemfile"
lockfile = "#{gemfile}.lock"
exec "bundle", *ARGV unless File.exist?(lockfile) # nothing we can do, regular bundle it is

require 'matching_bundle'

content = File.read(lockfile)
if version = MatchingBundle.find_or_install_matching_version(content)
  warn "Using bundler #{version}"
  exec "bundle", "_#{version}_", *ARGV
end
